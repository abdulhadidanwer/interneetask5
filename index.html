<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Real-Time Chat App</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f5f7;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  
  /* Chat container */
  #chat-container {
    width: 100%;
    max-width: 480px;
    height: 600px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 25px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  
  /* Chat header */
  #chat-header {
    padding: 20px;
    background: #4a90e2;
    color: white;
    font-weight: 700;
    font-size: 1.5em;
    user-select: none;
  }
  
  /* Chat messages box */
  #chat-box {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    background: #fefefe;
  }
  
  /* Message bubbles */
  .message {
    max-width: 75%;
    padding: 12px 16px;
    border-radius: 18px;
    position: relative;
    font-size: 0.95em;
    line-height: 1.3em;
    opacity: 0;
    transform: translateY(20px);
    animation: slideIn 0.3s forwards ease;
  }
  
  /* Sent messages (user) */
  .message.sent {
    background: #4a90e2;
    align-self: flex-end;
    color: white;
    border-bottom-right-radius: 2px;
    box-shadow: 0 1px 6px rgba(74, 144, 226, 0.5);
  }
  
  /* Received messages (bot) */
  .message.received {
    background: #e2e6ef;
    align-self: flex-start;
    color: #333;
    border-bottom-left-radius: 2px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
  }
  
  /* Timestamp */
  .timestamp {
    font-size: 0.75em;
    color: #666;
    margin-top: 4px;
    opacity: 0.7;
    user-select: none;
  }
  
  /* Input area */
  #input-area {
    display: flex;
    padding: 15px 20px;
    background: #fafafb;
    border-top: 1px solid #ddd;
  }
  
  input[type="text"] {
    flex: 1;
    padding: 12px 15px;
    font-size: 1em;
    border-radius: 25px;
    border: 1px solid #ccc;
    outline: none;
    transition: border-color 0.2s;
  }
  
  input[type="text"]:focus {
    border-color: #4a90e2;
  }
  
  button {
    background: #4a90e2;
    border: none;
    color: white;
    padding: 12px 25px;
    margin-left: 12px;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s;
  }
  
  button:disabled {
    background: #a2c1f7;
    cursor: not-allowed;
  }
  
  button:hover:not(:disabled) {
    background: #357abd;
  }
  
  /* Scrollbar styles */
  #chat-box::-webkit-scrollbar {
    width: 8px;
  }
  #chat-box::-webkit-scrollbar-track {
    background: transparent;
  }
  #chat-box::-webkit-scrollbar-thumb {
    background-color: #a2a8b9;
    border-radius: 20px;
  }
  
  @keyframes slideIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
</head>
<body>

<div id="chat-container">
  <div id="chat-header">Real-Time Chat</div>
  <div id="chat-box" role="log" aria-live="polite"></div>
  <form id="input-area" aria-label="Send a message">
    <input type="text" id="chat-input" autocomplete="off" placeholder="Type a message..." aria-required="true" />
    <button type="submit" id="send-btn" disabled>Send</button>
  </form>
</div>

<script>
  // Selectors
  const chatBox = document.getElementById('chat-box');
  const chatInput = document.getElementById('chat-input');
  const sendBtn = document.getElementById('send-btn');
  const inputForm = document.getElementById('input-area');

  // Simple chatbot predefined responses
  const botResponses = [
    "Hello! How can I assist you today?",
    "I'm here to help! What do you want to talk about?",
    "That's interesting!",
    "Could you tell me more?",
    "I see, thanks for sharing!",
    "Let me think about that...",
    "I'm not sure about that, but I'll try to help!",
    "Can you clarify your question?",
    "Thanks for your message!",
    "Have a great day!"
  ];

  // Load messages from localStorage or start fresh
  let messages = JSON.parse(localStorage.getItem('chat_messages')) || [];

  // Utility: format timestamp
  function formatTimestamp(date) {
    return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  }

  // Scroll chat to bottom smoothly
  function scrollToBottom() {
    chatBox.scrollTo({
      top: chatBox.scrollHeight,
      behavior: 'smooth'
    });
  }

  // Create message element and append to chatBox
  function addMessage(text, type, timestamp = new Date()) {
    // Save message to array & localStorage
    messages.push({text, type, timestamp: timestamp.toISOString()});
    localStorage.setItem('chat_messages', JSON.stringify(messages));
    
    // Create message container
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message', type);

    // Create text node
    const textNode = document.createTextNode(text);
    msgDiv.appendChild(textNode);

    // Timestamp span
    const timeSpan = document.createElement('div');
    timeSpan.classList.add('timestamp');
    timeSpan.textContent = formatTimestamp(new Date(timestamp));
    msgDiv.appendChild(timeSpan);

    // Append with animation
    chatBox.appendChild(msgDiv);

    // Scroll after DOM update
    scrollToBottom();
  }

  // Load all saved messages on page load
  function loadMessages() {
    messages.forEach(msg => {
      addMessage(msg.text, msg.type, new Date(msg.timestamp));
    });
  }

  // Because addMessage pushes to messages & localStorage,
  // we don't want duplicate storage when loading old messages. 
  // So we create slightly modified version without saving again.
  function renderMessagesWithoutSaving() {
    chatBox.innerHTML = '';
    messages.forEach(msg => {
      const msgDiv = document.createElement('div');
      msgDiv.classList.add('message', msg.type);

      const textNode = document.createTextNode(msg.text);
      msgDiv.appendChild(textNode);

      const timeSpan = document.createElement('div');
      timeSpan.classList.add('timestamp');
      timeSpan.textContent = formatTimestamp(new Date(msg.timestamp));
      msgDiv.appendChild(timeSpan);

      chatBox.appendChild(msgDiv);
    });
    scrollToBottom();
  }

  // Chatbot simple response function (random)
  function botReply() {
    // Bot waits between 0.5 to 1.5 seconds before replying
    const delay = 500 + Math.random() * 1000;
    setTimeout(() => {
      // Pick random response
      const response = botResponses[Math.floor(Math.random() * botResponses.length)];
      addMessage(response, 'received');
    }, delay);
  }

  // Enable/disable send button depending on input state
  chatInput.addEventListener('input', () => {
    sendBtn.disabled = chatInput.value.trim().length === 0;
  });

  // Handle message sending
  inputForm.addEventListener('submit', e => {
    e.preventDefault();
    const text = chatInput.value.trim();
    if (!text) return;

    addMessage(text, 'sent');
    chatInput.value = '';
    sendBtn.disabled = true;

    // Bot responds
    botReply();
  });

  // Initialize UI on load
  window.onload = () => {
    renderMessagesWithoutSaving();
    chatInput.focus();
  };
</script>

</body>
</html>
